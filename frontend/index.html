<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Open API</title>
</head>
<body>
    <form id="LocationInput" accept-charset="UTF-8"> 
        ID:<br>
        <input type="text" id="Location_id"><br>
        Name:<br>
        <input type="text" id="Location_name"><br>
        Address:<br>
        <input type="text" id="Location_address"><br>
        City:<br>
        <input type="text" id="Location_city"><br>
        Zip:<br>
        <input type="text" id="Location_zip"><br>
        Country:<br>
        <input type="text" id="Location_country"><br>
    </form>
    <br>
    <button type="button" onclick="getAll()">getAll</button> <button type="button" onclick="search()">search</button>
    <button type="button" onclick="insert()">insert</button> <button type="button" onclick="deleteData()">delete</button> 
    <button type="button" onclick="update()">update</button>
    <br>
    <div id="restMessage"></div>
    <br>
    <div id="restResults"></div> 

<script>
    var ip = "10.112.220.62:6502"

function update(){
    console.log("updating")
    var id = document.getElementById("Location_id").value
    id = parseInt(id)
    if(id == null){
        id = -1
    }
    console.log("id: "+id)
    var name = document.getElementById("Location_name").value
    console.log("name: "+name)
    var address = document.getElementById("Location_address").value
    console.log("address: "+address)
    var city = document.getElementById("Location_city").value
    console.log("city: "+city)
    var zip = document.getElementById("Location_zip").value
    zip = parseInt(zip)
    if(zip==null){
        zip = -1
    }
    console.log("zip: "+zip)
    var country = document.getElementById("Location_country").value
    console.log("country: "+country)

    if(!(typeof id == "number" && typeof zip == "number")){
        window.alert("Error: id/zip not a number")
    }else{
       var jsonAsText = "{"+
        '"Location_address" : "'+ address +'",'+
        '"Location_city": "'+ city+'",'+
        '"Location_country": "'+ country+'",'+
        '"Location_id":'+ id+','+
        '"Location_name": "'+ name+'",'+
        '"Location_zip":'+ zip +"}"

       console.log(jsonAsText)

    var xmlhttp = new XMLHttpRequest();
    var url = "http://"+ip+"/api/locations/update";
   
    xmlhttp.open("POST", url, false); 
    xmlhttp.setRequestHeader("Content-Type", "application/json");
    
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            var response = JSON.parse(xmlhttp.responseText);
            formatResponseMessage(response);
        }
    }
    xmlhttp.send(jsonAsText);
    }
}
function deleteData(){
    console.log("Deleting")
    var id = document.getElementById("Location_id").value
    id = parseInt(id)
    if(id == null){
        id = -1
    }
    console.log("id: "+id)
    var name = document.getElementById("Location_name").value
    console.log("name: "+name)
    var address = document.getElementById("Location_address").value
    console.log("address: "+address)
    var city = document.getElementById("Location_city").value
    console.log("city: "+city)
    var zip = document.getElementById("Location_zip").value
    zip = parseInt(zip)
    if(zip==null){
        zip = -1
    }
    console.log("zip: "+zip)
    var country = document.getElementById("Location_country").value
    console.log("country: "+country)

    if(!(typeof id == "number" && typeof zip == "number")){
        window.alert("Error: id/zip not a number")
    }else{
       var jsonAsText = "{"+
        '"Location_address" : "'+ address +'",'+
        '"Location_city": "'+ city+'",'+
        '"Location_country": "'+ country+'",'+
        '"Location_id":'+ id+','+
        '"Location_name": "'+ name+'",'+
        '"Location_zip":'+ zip +"}"

       console.log(jsonAsText)

    var xmlhttp = new XMLHttpRequest();
    var url = "http://"+ip+"/api/locations/delete";
   
    xmlhttp.open("DELETE", url, false); 
    xmlhttp.setRequestHeader("Content-Type", "application/json");
    
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            var response = JSON.parse(xmlhttp.responseText);
            formatResponseMessage(response);
        }
    }
    xmlhttp.send(jsonAsText);
    }
   
}
function insert(){
    console.log("Inserting")

    var name = document.getElementById("Location_name").value
    console.log("name: "+name)
    var address = document.getElementById("Location_address").value
    console.log("address: "+address)
    var city = document.getElementById("Location_city").value
    console.log("city: "+city)
    var zip = document.getElementById("Location_zip").value
    zip = parseInt(zip)
    if(zip==null){
        zip = -1
    }
    console.log("zip: "+zip)
    var country = document.getElementById("Location_country").value
    console.log("country: "+country)

    if(!( typeof zip == "number")){
        window.alert("Error: zip not a number")
    }else{
       var jsonAsText = "{"+
        '"Location_address" : "'+ address +'",'+
        '"Location_city": "'+ city+'",'+
        '"Location_country": "'+ country+'",'+

        '"Location_name": "'+ name+'",'+
        '"Location_zip":'+ zip +"}"

       console.log(jsonAsText)
   
    var xmlhttp = new XMLHttpRequest();
    var url = "http://"+ip+"/api/locations/add";
   
    xmlhttp.open("POST", url, false); 
    xmlhttp.setRequestHeader("Content-Type", "application/json");
    
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            var response = JSON.parse(xmlhttp.responseText);
            formatResponseMessage(response);
        }
    }
    xmlhttp.send(jsonAsText);
    }
}
function search(){
    console.log("Searching")
    var id = document.getElementById("Location_id").value
    id = parseInt(id)
    if(id == null){
        id = -1
    }
    console.log("id: "+id)
    var name = document.getElementById("Location_name").value
    console.log("name: "+name)
    var address = document.getElementById("Location_address").value
    console.log("address: "+address)
    var city = document.getElementById("Location_city").value
    console.log("city: "+city)
    var zip = document.getElementById("Location_zip").value
    zip = parseInt(zip)
    if(zip==null){
        zip = -1
    }
    console.log("zip: "+zip)
    var country = document.getElementById("Location_country").value
    console.log("country: "+country)

    if(!(typeof id == "number" && typeof zip == "number")){
        window.alert("Error: id/zip not a number")
    }else{
       var jsonAsText = "{"+
        '"Location_address" : "'+ address +'",'+
        '"Location_city": "'+ city+'",'+
        '"Location_country": "'+ country+'",'+
        '"Location_id":'+ id+','+
        '"Location_name": "'+ name+'",'+
        '"Location_zip":'+ zip +"}"

       console.log(jsonAsText)
       var request = JSON.parse(jsonAsText)
    console.log(request)
    var xmlhttp = new XMLHttpRequest();
    var url = "http://"+ip+"/api/locations/search";
   
    xmlhttp.open("POST", url, false); 
    xmlhttp.setRequestHeader("Content-Type", "application/json");
    
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            var response = JSON.parse(xmlhttp.responseText);
            formatResponseMessage(response);
        }
    }
    xmlhttp.send(jsonAsText);
    }
   
}

function getAll(){
    var xmlhttp = new XMLHttpRequest();
    var url = "http://"+ip+"/api/locations/all";
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            var response = JSON.parse(xmlhttp.responseText);
            formatResponse(response);
        }
    }
    xmlhttp.open("GET", url, true); 
    xmlhttp.send();
}

function formatResponseMessage(arr){
    console.log(arr)
    var out = "<p>"+arr.Results+"</p>"
    document.getElementById("restMessage").innerHTML = out;
}


function formatResponse(arr) {
    var out = "<table><tr><th>ID</th><th>Name</th><th>Address</th><th>City</th><th>Zip</th><th>Country</th></tr>";
    var i;
    for(i = 0; i < arr.length; i++) {
        out += "<tr><th>"+ arr[i].Location_id +"</th><th>"+arr[i].Location_name
        +"</th><th>"+arr[i].Location_address +"</th><th>"+arr[i].Location_city
        +"</th><th>"+arr[i].Location_zip+"</th><th>"+arr[i].Location_country+"</th></tr>"
    }
    out += "</table>"
    document.getElementById("restResults").innerHTML = out;
}
</script>
</body>
</html>